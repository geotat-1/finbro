<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>–£—á–µ—Ç —Å—á–µ—Ç–æ–≤</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 30px;
        background: #f9fafb;
        color: #222;
      }
      h1 {
        margin-top: 0;
      }
      table {
        border-collapse: collapse;
        margin-top: 20px;
        width: 100%;
      }
      th, td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      th {
        background: #f1f1f1;
      }
      input, select, button {
        padding: 6px;
        margin: 4px;
      }
      .total {
        font-weight: bold;
        margin-top: 10px;
      }
      .form-section {
        margin-top: 30px;
        padding: 20px;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      }
    </style>
  </head>
  <body>
    <h1>üí∞ –£—á—ë—Ç —Å—á–µ—Ç–æ–≤</h1>
    <div id="totalBalance" class="total"></div>
    <table id="accountsTable">
      <thead>
        <tr><th>–°—á—ë—Ç</th><th>–ë–∞–ª–∞–Ω—Å</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="form-section">
      <h2>‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é</h2>
      <form id="transactionForm">
        <label>–¢–∏–ø:</label>
        <select id="type">
          <option value="transfer">–ü–µ—Ä–µ–≤–æ–¥</option>
          <option value="income">–î–æ—Ö–æ–¥</option>
          <option value="expense">–†–∞—Å—Ö–æ–¥</option>
        </select><br>

        <label>–û—Ç–∫—É–¥–∞:</label>
        <select id="from"></select><br>

        <label>–ö—É–¥–∞:</label>
        <select id="to"></select><br>

        <label>–¢–µ–≥–∏:</label>
        <input type="text" id="tags" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –µ–¥–∞, —Ä–∞–±–æ—Ç–∞"><br>

        <label>–°—É–º–º–∞:</label>
        <input type="number" id="amount" step="0.01"><br>

        <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
      </form>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', loadData);
      function loadData() {
        google.script.run.withSuccessHandler(renderAccounts).getAccountsData();
      }

      function renderAccounts(data) {
        const tbody = document.querySelector('#accountsTable tbody');
        tbody.innerHTML = '';
        let total = 0;
        data.forEach(acc => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${acc.name}</td><td>${acc.balance}</td>`;
          tbody.appendChild(tr);
          total += Number(acc.balance);
        });
        document.getElementById('totalBalance').innerText = `–û–±—â–∏–π –±–∞–ª–∞–Ω—Å: ${total.toFixed(2)} ‚ÇΩ`;

        const selects = [document.getElementById('from'), document.getElementById('to')];
        selects.forEach(sel => {
          sel.innerHTML = '<option value="">‚Äî</option>';
          data.forEach(acc => {
            const opt = document.createElement('option');
            opt.value = acc.name;
            opt.textContent = acc.name;
            sel.appendChild(opt);
          });
        });
      }

      document.getElementById('transactionForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const transaction = {
          type: document.getElementById('type').value,
          from: document.getElementById('from').value,
          to: document.getElementById('to').value,
          tags: document.getElementById('tags').value,
          amount: parseFloat(document.getElementById('amount').value)
        };
        google.script.run
          .withSuccessHandler(() => {
            alert('‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞');
            loadData();
            document.getElementById('transactionForm').reset();
          })
          .addTransaction(transaction);
      });
    </script>
  </body>
</html>
